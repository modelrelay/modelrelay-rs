{
  "components": {
    "parameters": {
      "ProjectID": {
        "in": "path",
        "name": "id",
        "required": true,
        "schema": {
          "format": "uuid",
          "type": "string"
        }
      },
      "ToolHookID": {
        "in": "path",
        "name": "hook_id",
        "required": true,
        "schema": {
          "format": "uuid",
          "type": "string"
        }
      },
      "WebhookID": {
        "in": "path",
        "name": "webhook_id",
        "required": true,
        "schema": {
          "format": "uuid",
          "type": "string"
        }
      }
    },
    "schemas": {
      "APIError": {
        "properties": {
          "code": {
            "type": "string"
          },
          "error": {
            "type": "string"
          },
          "message": {
            "type": "string"
          }
        },
        "required": [
          "error",
          "code",
          "message"
        ],
        "type": "object"
      },
      "AuthResponse": {
        "properties": {
          "access_token": {
            "type": "string"
          },
          "refresh_token": {
            "type": "string"
          },
          "tokens": {
            "$ref": "#/components/schemas/AuthTokens"
          },
          "user": {
            "$ref": "#/components/schemas/User"
          }
        },
        "type": "object"
      },
      "AuthTokens": {
        "properties": {
          "access_token": {
            "type": "string"
          },
          "expires_at": {
            "format": "date-time",
            "type": "string"
          },
          "refresh_token": {
            "type": "string"
          }
        },
        "type": "object"
      },
      "BillingMode": {
        "description": "Billing mode for a project. 'managed' uses ModelRelay billing with tiers and subscriptions. 'byob' (Bring Your Own Billing) allows external billing.",
        "enum": [
          "managed",
          "byob"
        ],
        "type": "string"
      },
      "BillingProvider": {
        "description": "Billing provider backing the subscription or tier.",
        "enum": [
          "stripe",
          "crypto",
          "app_store",
          "external"
        ],
        "type": "string"
      },
      "ChangeTierRequest": {
        "properties": {
          "tier_code": {
            "description": "The tier code to switch to",
            "type": "string"
          }
        },
        "required": [
          "tier_code"
        ],
        "type": "object"
      },
      "CheckoutSessionResponse": {
        "properties": {
          "session_id": {
            "description": "Stripe checkout session ID",
            "type": "string"
          },
          "url": {
            "description": "Checkout URL",
            "format": "uri",
            "type": "string"
          }
        },
        "required": [
          "session_id",
          "url"
        ],
        "type": "object"
      },
      "Citation": {
        "properties": {
          "title": {
            "type": "string"
          },
          "url": {
            "type": "string"
          }
        },
        "type": "object"
      },
      "ContentPart": {
        "properties": {
          "text": {
            "type": "string"
          },
          "type": {
            "enum": [
              "text"
            ],
            "type": "string"
          }
        },
        "required": [
          "type"
        ],
        "type": "object"
      },
      "Customer": {
        "properties": {
          "created_at": {
            "format": "date-time",
            "type": "string"
          },
          "email": {
            "description": "Customer email address",
            "format": "email",
            "type": "string"
          },
          "external_id": {
            "description": "External customer identifier from your system",
            "maxLength": 255,
            "minLength": 1,
            "type": "string"
          },
          "id": {
            "format": "uuid",
            "type": "string"
          },
          "metadata": {
            "$ref": "#/components/schemas/CustomerMetadata"
          },
          "project_id": {
            "format": "uuid",
            "type": "string"
          },
          "updated_at": {
            "format": "date-time",
            "type": "string"
          }
        },
        "type": "object"
      },
      "CustomerBalanceResponse": {
        "properties": {
          "balance_cents": {
            "format": "int64",
            "minimum": 0,
            "type": "integer"
          },
          "billing_profile_id": {
            "description": "Billing profile UUID for wallet/balance.",
            "format": "uuid",
            "type": "string"
          },
          "currency": {
            "type": "string"
          },
          "customer_id": {
            "description": "Internal customer UUID (identity).",
            "format": "uuid",
            "type": "string"
          },
          "reserved_cents": {
            "format": "int64",
            "minimum": 0,
            "type": "integer"
          }
        },
        "required": [
          "customer_id",
          "billing_profile_id",
          "balance_cents",
          "reserved_cents",
          "currency"
        ],
        "type": "object"
      },
      "CustomerCreate": {
        "properties": {
          "email": {
            "description": "Customer email address",
            "format": "email",
            "type": "string"
          },
          "external_id": {
            "description": "External customer identifier from your system",
            "maxLength": 255,
            "minLength": 1,
            "type": "string"
          },
          "metadata": {
            "$ref": "#/components/schemas/CustomerMetadata"
          }
        },
        "required": [
          "external_id",
          "email"
        ],
        "type": "object"
      },
      "CustomerLedgerEntry": {
        "properties": {
          "amount_cents": {
            "format": "int64",
            "type": "integer"
          },
          "balance_after_cents": {
            "format": "int64",
            "type": "integer"
          },
          "credit_amount_cents": {
            "format": "int64",
            "type": "integer"
          },
          "description": {
            "type": "string"
          },
          "direction": {
            "type": "string"
          },
          "gross_amount_cents": {
            "format": "int64",
            "type": "integer"
          },
          "id": {
            "format": "uuid",
            "type": "string"
          },
          "input_tokens": {
            "format": "int64",
            "type": "integer"
          },
          "model_id": {
            "$ref": "#/components/schemas/ModelId"
          },
          "occurred_at": {
            "format": "date-time",
            "type": "string"
          },
          "output_tokens": {
            "format": "int64",
            "type": "integer"
          },
          "owner_revenue_cents": {
            "format": "int64",
            "type": "integer"
          },
          "platform_fee_cents": {
            "format": "int64",
            "type": "integer"
          },
          "reason": {
            "type": "string"
          },
          "request_id": {
            "format": "uuid",
            "type": "string"
          },
          "stripe_checkout_session_id": {
            "type": "string"
          },
          "stripe_invoice_id": {
            "type": "string"
          },
          "stripe_payment_intent_id": {
            "type": "string"
          }
        },
        "required": [
          "id",
          "direction",
          "reason",
          "amount_cents",
          "description",
          "occurred_at"
        ],
        "type": "object"
      },
      "CustomerLedgerResponse": {
        "properties": {
          "entries": {
            "items": {
              "$ref": "#/components/schemas/CustomerLedgerEntry"
            },
            "type": "array"
          }
        },
        "required": [
          "entries"
        ],
        "type": "object"
      },
      "CustomerMe": {
        "properties": {
          "customer": {
            "$ref": "#/components/schemas/Customer"
          },
          "subscription": {
            "$ref": "#/components/schemas/Subscription"
          },
          "tier": {
            "$ref": "#/components/schemas/Tier"
          }
        },
        "required": [
          "customer"
        ],
        "type": "object"
      },
      "CustomerMeCheckoutRequest": {
        "properties": {
          "cancel_url": {
            "description": "URL to redirect to if checkout is cancelled",
            "format": "uri",
            "type": "string"
          },
          "success_url": {
            "description": "URL to redirect to after successful checkout",
            "format": "uri",
            "type": "string"
          },
          "tier_code": {
            "description": "The tier code to subscribe to",
            "type": "string"
          }
        },
        "required": [
          "tier_code",
          "success_url",
          "cancel_url"
        ],
        "type": "object"
      },
      "CustomerMeResponse": {
        "properties": {
          "customer": {
            "$ref": "#/components/schemas/CustomerMe"
          }
        },
        "required": [
          "customer"
        ],
        "type": "object"
      },
      "CustomerMeSubscription": {
        "description": "Customer-visible subscription details for the current tier.",
        "properties": {
          "current_period_end": {
            "description": "End of the current billing period",
            "format": "date-time",
            "type": "string"
          },
          "current_period_start": {
            "description": "Start of the current billing period",
            "format": "date-time",
            "type": "string"
          },
          "price_amount_cents": {
            "description": "Subscription price amount in cents (omitted for free tiers)",
            "format": "int64",
            "minimum": 0,
            "type": "integer"
          },
          "price_currency": {
            "description": "Currency code for the price (e.g., 'usd')",
            "type": "string"
          },
          "price_interval": {
            "$ref": "#/components/schemas/PriceInterval"
          },
          "subscription_status": {
            "$ref": "#/components/schemas/SubscriptionStatusKind"
          },
          "tier_code": {
            "$ref": "#/components/schemas/TierCode"
          },
          "tier_display_name": {
            "description": "Human-readable tier name",
            "maxLength": 255,
            "minLength": 1,
            "type": "string"
          }
        },
        "required": [
          "tier_code",
          "tier_display_name"
        ],
        "type": "object"
      },
      "CustomerMeSubscriptionResponse": {
        "properties": {
          "subscription": {
            "$ref": "#/components/schemas/CustomerMeSubscription"
          }
        },
        "required": [
          "subscription"
        ],
        "type": "object"
      },
      "CustomerMeUsage": {
        "description": "Customer-visible usage metrics for the current billing window.",
        "properties": {
          "credits_granted_cents": {
            "description": "Credits granted for this billing window (only for paid tiers)",
            "format": "int64",
            "minimum": 0,
            "type": "integer"
          },
          "credits_remaining_cents": {
            "description": "Credits remaining in this billing window (only for paid tiers)",
            "format": "int64",
            "minimum": 0,
            "type": "integer"
          },
          "credits_used_cents": {
            "description": "Credits used so far in this billing window (only for paid tiers)",
            "format": "int64",
            "minimum": 0,
            "type": "integer"
          },
          "daily": {
            "items": {
              "$ref": "#/components/schemas/CustomerUsagePoint"
            },
            "type": "array"
          },
          "images": {
            "format": "int64",
            "minimum": 0,
            "type": "integer"
          },
          "low": {
            "description": "Whether remaining credits are low (only for paid tiers)",
            "type": "boolean"
          },
          "overage_enabled": {
            "description": "True when PAYGO wallet can cover subscription overages",
            "type": "boolean"
          },
          "percentage_used": {
            "description": "Percentage of granted credits used (only for paid tiers)",
            "format": "float",
            "maximum": 100,
            "minimum": 0,
            "type": "number"
          },
          "requests": {
            "format": "int64",
            "minimum": 0,
            "type": "integer"
          },
          "tokens": {
            "format": "int64",
            "minimum": 0,
            "type": "integer"
          },
          "wallet_balance_cents": {
            "description": "PAYGO wallet balance in cents (available when PAYGO wallet is enabled)",
            "format": "int64",
            "minimum": 0,
            "type": "integer"
          },
          "wallet_reserved_cents": {
            "description": "PAYGO wallet reserved amount in cents",
            "format": "int64",
            "minimum": 0,
            "type": "integer"
          },
          "window_end": {
            "description": "End of the current billing window",
            "format": "date-time",
            "type": "string"
          },
          "window_start": {
            "description": "Start of the current billing window",
            "format": "date-time",
            "type": "string"
          }
        },
        "required": [
          "window_start",
          "window_end",
          "requests",
          "tokens",
          "images",
          "daily"
        ],
        "type": "object"
      },
      "CustomerMeUsageResponse": {
        "properties": {
          "usage": {
            "$ref": "#/components/schemas/CustomerMeUsage"
          }
        },
        "required": [
          "usage"
        ],
        "type": "object"
      },
      "CustomerMetadata": {
        "additionalProperties": true,
        "description": "Arbitrary customer metadata (max 10KB). Keys are limited to 40 characters. Values can be any JSON type. Nesting depth limited to 5 levels.",
        "type": "object"
      },
      "CustomerTokenResponse": {
        "properties": {
          "billing_profile_id": {
            "description": "Billing profile UUID for managed billing customers.",
            "format": "uuid",
            "type": "string"
          },
          "customer_external_id": {
            "description": "External customer identifier",
            "maxLength": 255,
            "minLength": 1,
            "type": "string"
          },
          "customer_id": {
            "description": "Internal customer UUID (identity).",
            "format": "uuid",
            "type": "string"
          },
          "expires_at": {
            "description": "Token expiration timestamp",
            "format": "date-time",
            "type": "string"
          },
          "expires_in": {
            "description": "Seconds until token expires",
            "format": "uint32",
            "minimum": 0,
            "type": "integer"
          },
          "project_id": {
            "description": "Project the token is scoped to",
            "format": "uuid",
            "type": "string"
          },
          "tier_code": {
            "$ref": "#/components/schemas/TierCode"
          },
          "token": {
            "description": "The customer bearer token",
            "type": "string"
          }
        },
        "required": [
          "token",
          "expires_at",
          "expires_in",
          "project_id",
          "customer_external_id",
          "customer_id"
        ],
        "type": "object"
      },
      "CustomerTopupRequest": {
        "properties": {
          "cancel_url": {
            "format": "uri",
            "type": "string"
          },
          "credit_amount_cents": {
            "format": "int64",
            "minimum": 1,
            "type": "integer"
          },
          "success_url": {
            "format": "uri",
            "type": "string"
          }
        },
        "required": [
          "credit_amount_cents",
          "success_url",
          "cancel_url"
        ],
        "type": "object"
      },
      "CustomerTopupResponse": {
        "properties": {
          "checkout_url": {
            "format": "uri",
            "type": "string"
          },
          "credit_amount_cents": {
            "format": "int64",
            "type": "integer"
          },
          "gross_amount_cents": {
            "format": "int64",
            "type": "integer"
          },
          "owner_revenue_cents": {
            "format": "int64",
            "type": "integer"
          },
          "platform_fee_cents": {
            "format": "int64",
            "type": "integer"
          },
          "session_id": {
            "type": "string"
          },
          "status": {
            "type": "string"
          }
        },
        "required": [
          "session_id",
          "checkout_url",
          "gross_amount_cents",
          "credit_amount_cents",
          "owner_revenue_cents",
          "platform_fee_cents",
          "status"
        ],
        "type": "object"
      },
      "CustomerUsagePoint": {
        "properties": {
          "credits_used_cents": {
            "description": "Credits used in this day bucket (only for paid tiers)",
            "format": "int64",
            "minimum": 0,
            "type": "integer"
          },
          "day": {
            "description": "UTC day bucket",
            "format": "date-time",
            "type": "string"
          },
          "images": {
            "format": "int64",
            "minimum": 0,
            "type": "integer"
          },
          "requests": {
            "format": "int64",
            "minimum": 0,
            "type": "integer"
          },
          "tokens": {
            "format": "int64",
            "minimum": 0,
            "type": "integer"
          }
        },
        "required": [
          "day",
          "requests",
          "tokens"
        ],
        "type": "object"
      },
      "CustomerWithSubscription": {
        "properties": {
          "billing_customer_id": {
            "description": "Billing provider customer ID (e.g., Stripe customer ID)",
            "type": "string"
          },
          "customer": {
            "$ref": "#/components/schemas/Customer"
          },
          "subscription": {
            "$ref": "#/components/schemas/Subscription"
          }
        },
        "required": [
          "customer"
        ],
        "type": "object"
      },
      "ImageData": {
        "description": "A single generated image.",
        "properties": {
          "b64_json": {
            "description": "Base64-encoded image data (when response_format is 'b64_json')",
            "type": "string"
          },
          "expires_at": {
            "description": "When the image URL expires (null if pinned)",
            "format": "date-time",
            "type": "string"
          },
          "image_id": {
            "description": "Unique identifier for the image (used for pinning)",
            "type": "string"
          },
          "mime_type": {
            "description": "MIME type of the image (e.g., 'image/png', 'image/webp')",
            "type": "string"
          },
          "pin_url": {
            "description": "URL to pin this image for permanent storage",
            "type": "string"
          },
          "url": {
            "description": "URL of the generated image (when response_format is 'url')",
            "type": "string"
          }
        },
        "type": "object"
      },
      "ImagePinResponse": {
        "description": "Response from pin/unpin operations.",
        "properties": {
          "expires_at": {
            "description": "When the image expires (null if pinned)",
            "format": "date-time",
            "type": "string"
          },
          "id": {
            "description": "Image ID",
            "type": "string"
          },
          "pinned": {
            "description": "Whether the image is currently pinned",
            "type": "boolean"
          },
          "url": {
            "description": "URL of the image",
            "type": "string"
          }
        },
        "required": [
          "id",
          "pinned",
          "url"
        ],
        "type": "object"
      },
      "ImageRequest": {
        "description": "Request to generate images from a text prompt.",
        "properties": {
          "model": {
            "description": "Image generation model ID (e.g., gemini-2.5-flash-image). Optional when using a customer token with a tier that defines a default model.",
            "type": "string"
          },
          "n": {
            "default": 1,
            "description": "Number of images to generate (1-10, default 1)",
            "maximum": 10,
            "minimum": 1,
            "type": "integer"
          },
          "prompt": {
            "description": "Text description of the image to generate",
            "type": "string"
          },
          "response_format": {
            "$ref": "#/components/schemas/ImageResponseFormat"
          }
        },
        "required": [
          "prompt"
        ],
        "type": "object"
      },
      "ImageResponse": {
        "description": "Response containing generated images.",
        "properties": {
          "data": {
            "description": "Generated images",
            "items": {
              "$ref": "#/components/schemas/ImageData"
            },
            "type": "array"
          },
          "id": {
            "description": "Unique identifier for this generation request",
            "type": "string"
          },
          "model": {
            "description": "Model used for generation",
            "type": "string"
          },
          "usage": {
            "$ref": "#/components/schemas/ImageUsage"
          }
        },
        "required": [
          "id",
          "model",
          "data",
          "usage"
        ],
        "type": "object"
      },
      "ImageResponseFormat": {
        "default": "url",
        "description": "Output format for generated images.",
        "enum": [
          "url",
          "b64_json"
        ],
        "type": "string"
      },
      "ImageUsage": {
        "description": "Usage statistics for image generation.",
        "properties": {
          "images": {
            "description": "Number of images generated",
            "format": "int32",
            "type": "integer"
          }
        },
        "required": [
          "images"
        ],
        "type": "object"
      },
      "InputItem": {
        "properties": {
          "content": {
            "items": {
              "$ref": "#/components/schemas/ContentPart"
            },
            "type": "array"
          },
          "role": {
            "$ref": "#/components/schemas/MessageRole"
          },
          "tool_call_id": {
            "$ref": "#/components/schemas/ToolCallId"
          },
          "tool_calls": {
            "items": {
              "$ref": "#/components/schemas/ToolCall"
            },
            "type": "array"
          },
          "type": {
            "enum": [
              "message"
            ],
            "type": "string"
          }
        },
        "required": [
          "type"
        ],
        "type": "object"
      },
      "JSONPatchOperation": {
        "properties": {
          "from": {
            "type": "string"
          },
          "op": {
            "enum": [
              "add",
              "remove",
              "replace",
              "move",
              "copy",
              "test"
            ],
            "type": "string"
          },
          "path": {
            "type": "string"
          },
          "value": {
            "additionalProperties": true,
            "type": "object"
          }
        },
        "required": [
          "op",
          "path"
        ],
        "type": "object"
      },
      "JSONSchemaFormat": {
        "properties": {
          "description": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "schema": {
            "additionalProperties": true,
            "type": "object"
          },
          "strict": {
            "type": "boolean"
          }
        },
        "required": [
          "name"
        ],
        "type": "object"
      },
      "MessageRole": {
        "enum": [
          "system",
          "user",
          "assistant",
          "tool"
        ],
        "type": "string"
      },
      "Model": {
        "properties": {
          "capabilities": {
            "items": {
              "$ref": "#/components/schemas/ModelCapability"
            },
            "type": "array"
          },
          "context_window": {
            "format": "int32",
            "minimum": 0,
            "type": "integer"
          },
          "deprecated": {
            "type": "boolean"
          },
          "deprecation_message": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "display_name": {
            "type": "string"
          },
          "input_cost_per_million_cents": {
            "format": "uint64",
            "minimum": 0,
            "type": "integer"
          },
          "max_output_tokens": {
            "format": "int32",
            "minimum": 0,
            "type": "integer"
          },
          "model_id": {
            "$ref": "#/components/schemas/ModelId"
          },
          "output_cost_per_million_cents": {
            "format": "uint64",
            "minimum": 0,
            "type": "integer"
          },
          "provider": {
            "$ref": "#/components/schemas/ProviderId"
          },
          "training_cutoff": {
            "description": "Training cutoff in YYYY-MM format",
            "type": "string"
          }
        },
        "required": [
          "model_id",
          "provider",
          "display_name",
          "description",
          "capabilities",
          "context_window",
          "max_output_tokens",
          "training_cutoff",
          "deprecated",
          "deprecation_message",
          "input_cost_per_million_cents",
          "output_cost_per_million_cents"
        ],
        "type": "object"
      },
      "ModelCapability": {
        "description": "Workflow-critical model capability identifier.",
        "enum": [
          "text_generation",
          "tools",
          "vision",
          "web_search",
          "web_fetch",
          "computer_use",
          "code_execution",
          "image_generation"
        ],
        "type": "string"
      },
      "ModelId": {
        "description": "LLM model identifier (e.g., claude-sonnet-4-5, gpt-4o).",
        "maxLength": 128,
        "minLength": 1,
        "type": "string"
      },
      "ModelsResponse": {
        "properties": {
          "models": {
            "items": {
              "$ref": "#/components/schemas/Model"
            },
            "type": "array"
          }
        },
        "required": [
          "models"
        ],
        "type": "object"
      },
      "NDJSONStreamEvent": {
        "description": "Events sent during streaming responses (application/x-ndjson).\nEach line is a JSON object with an \"event\" field indicating the type.\n",
        "properties": {
          "event": {
            "description": "Event type",
            "enum": [
              "message_start",
              "message_delta",
              "message_stop",
              "tool_use_start",
              "tool_use_delta",
              "tool_use_stop",
              "ping",
              "keepalive"
            ],
            "type": "string"
          },
          "model": {
            "$ref": "#/components/schemas/ModelId"
          },
          "response_id": {
            "description": "Response identifier (message_start)",
            "type": "string"
          },
          "stop_reason": {
            "description": "Why generation stopped (message_stop)",
            "type": "string"
          },
          "text_delta": {
            "description": "Text content fragment (message_delta)",
            "type": "string"
          },
          "tool_call_delta": {
            "$ref": "#/components/schemas/ToolCallDelta"
          },
          "tool_calls": {
            "description": "Completed tool calls (tool_use_stop, message_stop)",
            "items": {
              "$ref": "#/components/schemas/ToolCall"
            },
            "type": "array"
          },
          "usage": {
            "$ref": "#/components/schemas/Usage"
          }
        },
        "required": [
          "event"
        ],
        "type": "object"
      },
      "NodeErrorV0": {
        "properties": {
          "code": {
            "type": "string"
          },
          "detail": {
            "description": "Raw error details from the provider",
            "type": "string"
          },
          "message": {
            "type": "string"
          }
        },
        "required": [
          "message"
        ],
        "type": "object"
      },
      "NodeId": {
        "description": "Workflow node identifier. Must start with a lowercase letter and contain only lowercase letters, numbers, and underscores.",
        "maxLength": 64,
        "minLength": 1,
        "pattern": "^[a-z][a-z0-9_]*$",
        "type": "string"
      },
      "NodeResultV0": {
        "properties": {
          "ended_at": {
            "format": "date-time",
            "type": "string"
          },
          "error": {
            "$ref": "#/components/schemas/NodeErrorV0"
          },
          "id": {
            "$ref": "#/components/schemas/NodeId"
          },
          "output": {
            "additionalProperties": true,
            "type": "object"
          },
          "started_at": {
            "format": "date-time",
            "type": "string"
          },
          "status": {
            "$ref": "#/components/schemas/NodeStatusV0"
          },
          "type": {
            "$ref": "#/components/schemas/NodeTypeV0"
          }
        },
        "required": [
          "id",
          "type",
          "status"
        ],
        "type": "object"
      },
      "NodeStatusV0": {
        "enum": [
          "pending",
          "running",
          "waiting",
          "succeeded",
          "failed",
          "canceled"
        ],
        "type": "string"
      },
      "NodeTypeV0": {
        "description": "Type of workflow node.",
        "enum": [
          "llm.responses",
          "route.switch",
          "join.all",
          "join.any",
          "join.collect",
          "map.fanout",
          "transform.json"
        ],
        "type": "string"
      },
      "OutboundWebhookEvent": {
        "properties": {
          "attempt_count": {
            "format": "int32",
            "type": "integer"
          },
          "created_at": {
            "format": "date-time",
            "type": "string"
          },
          "error": {
            "type": "string"
          },
          "event_id": {
            "type": "string"
          },
          "event_type": {
            "type": "string"
          },
          "id": {
            "format": "uuid",
            "type": "string"
          },
          "last_attempt_at": {
            "format": "date-time",
            "type": "string"
          },
          "latency_ms": {
            "format": "int32",
            "type": "integer"
          },
          "next_attempt_at": {
            "format": "date-time",
            "type": "string"
          },
          "payload": {
            "type": "object"
          },
          "response_body": {
            "type": "string"
          },
          "response_status": {
            "format": "int32",
            "type": "integer"
          },
          "status": {
            "type": "string"
          },
          "updated_at": {
            "format": "date-time",
            "type": "string"
          },
          "webhook_config_id": {
            "format": "uuid",
            "type": "string"
          }
        },
        "type": "object"
      },
      "OutputFormat": {
        "properties": {
          "json_schema": {
            "$ref": "#/components/schemas/JSONSchemaFormat"
          },
          "type": {
            "enum": [
              "text",
              "json_schema"
            ],
            "type": "string"
          }
        },
        "required": [
          "type"
        ],
        "type": "object"
      },
      "OutputItem": {
        "properties": {
          "content": {
            "items": {
              "$ref": "#/components/schemas/ContentPart"
            },
            "type": "array"
          },
          "role": {
            "$ref": "#/components/schemas/MessageRole"
          },
          "tool_calls": {
            "items": {
              "$ref": "#/components/schemas/ToolCall"
            },
            "type": "array"
          },
          "type": {
            "enum": [
              "message"
            ],
            "type": "string"
          }
        },
        "required": [
          "type"
        ],
        "type": "object"
      },
      "PlanHash": {
        "description": "SHA-256 hash of the compiled workflow plan (64 hex characters).",
        "maxLength": 64,
        "minLength": 64,
        "pattern": "^[a-f0-9]{64}$",
        "type": "string"
      },
      "PluginAgentV0": {
        "properties": {
          "name": {
            "type": "string"
          },
          "system_prompt": {
            "type": "string"
          }
        },
        "required": [
          "name",
          "system_prompt"
        ],
        "type": "object"
      },
      "PluginCommandV0": {
        "properties": {
          "agent_refs": {
            "items": {
              "type": "string"
            },
            "type": "array"
          },
          "name": {
            "type": "string"
          },
          "prompt": {
            "type": "string"
          }
        },
        "required": [
          "name",
          "prompt"
        ],
        "type": "object"
      },
      "PluginGitHubRefV0": {
        "properties": {
          "owner": {
            "type": "string"
          },
          "path": {
            "type": "string"
          },
          "ref": {
            "type": "string"
          },
          "repo": {
            "type": "string"
          }
        },
        "type": "object"
      },
      "PluginManifestV0": {
        "properties": {
          "agents": {
            "items": {
              "type": "string"
            },
            "type": "array"
          },
          "commands": {
            "items": {
              "type": "string"
            },
            "type": "array"
          },
          "description": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "version": {
            "type": "string"
          }
        },
        "type": "object"
      },
      "PriceInterval": {
        "description": "Billing interval for a tier.",
        "enum": [
          "month",
          "year"
        ],
        "type": "string"
      },
      "Project": {
        "properties": {
          "billing_mode": {
            "$ref": "#/components/schemas/BillingMode"
          },
          "created_at": {
            "format": "date-time",
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "id": {
            "format": "uuid",
            "type": "string"
          },
          "markup_percentage": {
            "maximum": 100,
            "minimum": 0,
            "type": "number"
          },
          "name": {
            "type": "string"
          },
          "owner_id": {
            "format": "uuid",
            "type": "string"
          },
          "updated_at": {
            "format": "date-time",
            "type": "string"
          }
        },
        "type": "object"
      },
      "ProviderId": {
        "description": "LLM provider identifier.",
        "enum": [
          "anthropic",
          "openai",
          "xai",
          "google-ai-studio"
        ],
        "type": "string"
      },
      "RequestId": {
        "description": "Unique identifier for an LLM request within a workflow run.",
        "format": "uuid",
        "type": "string"
      },
      "ResponsesBatchError": {
        "properties": {
          "code": {
            "type": "string"
          },
          "detail": {
            "description": "Raw error details from the provider",
            "type": "string"
          },
          "message": {
            "type": "string"
          },
          "status": {
            "type": "integer"
          }
        },
        "required": [
          "status",
          "message"
        ],
        "type": "object"
      },
      "ResponsesBatchRequest": {
        "properties": {
          "options": {
            "properties": {
              "abort_on_error": {
                "type": "boolean"
              },
              "max_parallelism": {
                "format": "uint32",
                "maximum": 100,
                "minimum": 1,
                "type": "integer"
              }
            },
            "type": "object"
          },
          "requests": {
            "items": {
              "$ref": "#/components/schemas/ResponsesRequest"
            },
            "type": "array"
          }
        },
        "required": [
          "requests"
        ],
        "type": "object"
      },
      "ResponsesBatchResponse": {
        "properties": {
          "request_id": {
            "type": "string"
          },
          "results": {
            "items": {
              "$ref": "#/components/schemas/ResponsesBatchResult"
            },
            "type": "array"
          }
        },
        "required": [
          "results"
        ],
        "type": "object"
      },
      "ResponsesBatchResult": {
        "properties": {
          "error": {
            "$ref": "#/components/schemas/ResponsesBatchError"
          },
          "index": {
            "format": "uint32",
            "minimum": 0,
            "type": "integer"
          },
          "ok": {
            "type": "boolean"
          },
          "response": {
            "$ref": "#/components/schemas/ResponsesResponse"
          }
        },
        "required": [
          "index",
          "ok"
        ],
        "type": "object"
      },
      "ResponsesRequest": {
        "properties": {
          "input": {
            "items": {
              "$ref": "#/components/schemas/InputItem"
            },
            "type": "array"
          },
          "max_output_tokens": {
            "format": "uint32",
            "minimum": 0,
            "type": "integer"
          },
          "model": {
            "$ref": "#/components/schemas/ModelId"
          },
          "output_format": {
            "$ref": "#/components/schemas/OutputFormat"
          },
          "provider": {
            "$ref": "#/components/schemas/ProviderId"
          },
          "stop": {
            "items": {
              "type": "string"
            },
            "type": "array"
          },
          "temperature": {
            "type": "number"
          },
          "tool_choice": {
            "$ref": "#/components/schemas/ToolChoice"
          },
          "tools": {
            "items": {
              "$ref": "#/components/schemas/Tool"
            },
            "type": "array"
          }
        },
        "required": [
          "input"
        ],
        "type": "object"
      },
      "ResponsesResponse": {
        "properties": {
          "citations": {
            "description": "Sources from web search results",
            "items": {
              "$ref": "#/components/schemas/Citation"
            },
            "type": "array"
          },
          "id": {
            "description": "Response identifier from the provider",
            "type": "string"
          },
          "model": {
            "$ref": "#/components/schemas/ModelId"
          },
          "output": {
            "items": {
              "$ref": "#/components/schemas/OutputItem"
            },
            "type": "array"
          },
          "provider": {
            "$ref": "#/components/schemas/ProviderId"
          },
          "stop_reason": {
            "description": "Why generation stopped (stop, max_tokens, tool_use, etc.)",
            "type": "string"
          },
          "usage": {
            "$ref": "#/components/schemas/Usage"
          }
        },
        "required": [
          "id",
          "output",
          "model",
          "usage"
        ],
        "type": "object"
      },
      "ResponsesStreamEnvelope": {
        "properties": {
          "code": {
            "type": "string"
          },
          "complete_fields": {
            "items": {
              "type": "string"
            },
            "type": "array"
          },
          "content": {
            "type": "string"
          },
          "delta": {
            "type": "string"
          },
          "message": {
            "type": "string"
          },
          "model": {
            "$ref": "#/components/schemas/ModelId"
          },
          "patch": {
            "items": {
              "$ref": "#/components/schemas/JSONPatchOperation"
            },
            "type": "array"
          },
          "payload": {
            "additionalProperties": true,
            "type": "object"
          },
          "provider": {
            "$ref": "#/components/schemas/ProviderId"
          },
          "request_id": {
            "type": "string"
          },
          "status": {
            "type": "integer"
          },
          "stop_reason": {
            "type": "string"
          },
          "stream_mode": {
            "enum": [
              "text-delta",
              "structured-patch"
            ],
            "type": "string"
          },
          "stream_version": {
            "enum": [
              "v2"
            ],
            "type": "string"
          },
          "type": {
            "enum": [
              "start",
              "update",
              "completion",
              "error",
              "keepalive",
              "tool_use_start",
              "tool_use_delta",
              "tool_use_stop"
            ],
            "type": "string"
          },
          "usage": {
            "$ref": "#/components/schemas/Usage"
          }
        },
        "required": [
          "type"
        ],
        "type": "object"
      },
      "RunCostLineItemV0": {
        "properties": {
          "input_tokens": {
            "format": "uint64",
            "minimum": 0,
            "type": "integer"
          },
          "model": {
            "$ref": "#/components/schemas/ModelId"
          },
          "output_tokens": {
            "format": "uint64",
            "minimum": 0,
            "type": "integer"
          },
          "provider_id": {
            "$ref": "#/components/schemas/ProviderId"
          },
          "requests": {
            "format": "uint64",
            "minimum": 0,
            "type": "integer"
          },
          "usd_cents": {
            "format": "uint64",
            "minimum": 0,
            "type": "integer"
          }
        },
        "required": [
          "provider_id",
          "model",
          "requests",
          "input_tokens",
          "output_tokens",
          "usd_cents"
        ],
        "type": "object"
      },
      "RunCostSummaryV0": {
        "properties": {
          "line_items": {
            "items": {
              "$ref": "#/components/schemas/RunCostLineItemV0"
            },
            "type": "array"
          },
          "total_usd_cents": {
            "format": "uint64",
            "minimum": 0,
            "type": "integer"
          }
        },
        "required": [
          "total_usd_cents"
        ],
        "type": "object"
      },
      "RunId": {
        "description": "Unique identifier for a workflow run.",
        "format": "uuid",
        "type": "string"
      },
      "RunStatusV0": {
        "enum": [
          "running",
          "waiting",
          "succeeded",
          "failed",
          "canceled"
        ],
        "type": "string"
      },
      "RunsCreateOptionsV0": {
        "properties": {
          "idempotency_key": {
            "type": "string"
          }
        },
        "type": "object"
      },
      "RunsCreateRequest": {
        "properties": {
          "input": {
            "additionalProperties": true,
            "description": "Runtime inputs for the workflow. Required when the spec uses from_input references (e.g., map.fanout with items.from_input). Each key is the input name, and the value is the JSON data to provide.",
            "type": "object"
          },
          "options": {
            "$ref": "#/components/schemas/RunsCreateOptionsV0"
          },
          "session_id": {
            "description": "Optional session ID to link this run to a session.",
            "format": "uuid",
            "type": "string"
          },
          "spec": {
            "$ref": "#/components/schemas/WorkflowSpecV1"
          }
        },
        "required": [
          "spec"
        ],
        "type": "object"
      },
      "RunsCreateResponse": {
        "properties": {
          "plan_hash": {
            "$ref": "#/components/schemas/PlanHash"
          },
          "run_id": {
            "$ref": "#/components/schemas/RunId"
          },
          "status": {
            "$ref": "#/components/schemas/RunStatusV0"
          }
        },
        "required": [
          "run_id",
          "status",
          "plan_hash"
        ],
        "type": "object"
      },
      "RunsGetResponse": {
        "properties": {
          "cost_summary": {
            "$ref": "#/components/schemas/RunCostSummaryV0"
          },
          "nodes": {
            "items": {
              "$ref": "#/components/schemas/NodeResultV0"
            },
            "type": "array"
          },
          "outputs": {
            "additionalProperties": true,
            "type": "object"
          },
          "plan_hash": {
            "$ref": "#/components/schemas/PlanHash"
          },
          "run_id": {
            "$ref": "#/components/schemas/RunId"
          },
          "status": {
            "$ref": "#/components/schemas/RunStatusV0"
          }
        },
        "required": [
          "run_id",
          "status",
          "plan_hash",
          "cost_summary"
        ],
        "type": "object"
      },
      "RunsPendingToolCallV0": {
        "description": "A pending tool call waiting for a result.",
        "properties": {
          "arguments": {
            "description": "JSON-encoded arguments for the tool call",
            "type": "string"
          },
          "name": {
            "$ref": "#/components/schemas/ToolName",
            "description": "Name of the tool to be called"
          },
          "tool_call_id": {
            "$ref": "#/components/schemas/ToolCallId",
            "description": "Unique identifier for this tool call"
          }
        },
        "required": [
          "tool_call_id",
          "name",
          "arguments"
        ],
        "type": "object"
      },
      "RunsPendingToolsNodeV0": {
        "description": "A node with pending tool calls.",
        "properties": {
          "node_id": {
            "$ref": "#/components/schemas/NodeId"
          },
          "request_id": {
            "$ref": "#/components/schemas/RequestId"
          },
          "step": {
            "description": "The step number within the node execution",
            "format": "uint64",
            "minimum": 0,
            "type": "integer"
          },
          "tool_calls": {
            "items": {
              "$ref": "#/components/schemas/RunsPendingToolCallV0"
            },
            "type": "array"
          }
        },
        "required": [
          "node_id",
          "step",
          "request_id"
        ],
        "type": "object"
      },
      "RunsPendingToolsResponse": {
        "description": "Response containing pending tool calls for a workflow run.",
        "properties": {
          "pending": {
            "items": {
              "$ref": "#/components/schemas/RunsPendingToolsNodeV0"
            },
            "type": "array"
          },
          "run_id": {
            "$ref": "#/components/schemas/RunId"
          }
        },
        "required": [
          "run_id"
        ],
        "type": "object"
      },
      "SessionCreateRequest": {
        "description": "Request body for creating a session.",
        "properties": {
          "customer_id": {
            "description": "Optional customer ID to associate with the session",
            "format": "uuid",
            "type": "string"
          },
          "metadata": {
            "additionalProperties": true,
            "description": "Optional metadata for the session",
            "type": "object"
          }
        },
        "type": "object"
      },
      "SessionListResponse": {
        "description": "Paginated list of sessions.",
        "properties": {
          "next_cursor": {
            "description": "Cursor for fetching the next page (if more results exist)",
            "type": "string"
          },
          "sessions": {
            "description": "List of sessions",
            "items": {
              "$ref": "#/components/schemas/SessionResponse"
            },
            "type": "array"
          }
        },
        "required": [
          "sessions"
        ],
        "type": "object"
      },
      "SessionMessageCreateRequest": {
        "description": "Request body for appending a message to a session.",
        "properties": {
          "content": {
            "description": "Message content parts",
            "items": {
              "additionalProperties": true,
              "type": "object"
            },
            "type": "array"
          },
          "role": {
            "description": "Message role (user, assistant, tool)",
            "type": "string"
          },
          "run_id": {
            "description": "Run ID that generated this message (for assistant messages)",
            "format": "uuid",
            "type": "string"
          }
        },
        "required": [
          "role",
          "content"
        ],
        "type": "object"
      },
      "SessionMessageResponse": {
        "description": "A message within a session.",
        "properties": {
          "content": {
            "description": "Message content parts",
            "items": {
              "additionalProperties": true,
              "type": "object"
            },
            "type": "array"
          },
          "created_at": {
            "description": "Message creation timestamp",
            "format": "date-time",
            "type": "string"
          },
          "id": {
            "description": "Message unique identifier",
            "format": "uuid",
            "type": "string"
          },
          "role": {
            "description": "Message role (user, assistant, tool)",
            "type": "string"
          },
          "run_id": {
            "description": "Run ID that generated this message (for assistant messages)",
            "format": "uuid",
            "type": "string"
          },
          "seq": {
            "description": "Sequence number within the session",
            "format": "int32",
            "type": "integer"
          }
        },
        "required": [
          "id",
          "seq",
          "role",
          "content",
          "created_at"
        ],
        "type": "object"
      },
      "SessionResponse": {
        "description": "A session resource.",
        "properties": {
          "created_at": {
            "description": "Session creation timestamp",
            "format": "date-time",
            "type": "string"
          },
          "customer_id": {
            "description": "Customer associated with the session (if any)",
            "format": "uuid",
            "type": "string"
          },
          "id": {
            "description": "Session unique identifier",
            "format": "uuid",
            "type": "string"
          },
          "message_count": {
            "description": "Number of messages in the session",
            "format": "int64",
            "type": "integer"
          },
          "metadata": {
            "additionalProperties": true,
            "description": "Session metadata",
            "type": "object"
          },
          "project_id": {
            "description": "Project the session belongs to",
            "format": "uuid",
            "type": "string"
          },
          "updated_at": {
            "description": "Session last update timestamp",
            "format": "date-time",
            "type": "string"
          }
        },
        "required": [
          "id",
          "project_id",
          "metadata",
          "message_count",
          "created_at",
          "updated_at"
        ],
        "type": "object"
      },
      "SessionUpdateRequest": {
        "description": "Request body for updating session metadata. Null values remove keys.",
        "properties": {
          "metadata": {
            "additionalProperties": true,
            "description": "Metadata fields to set or remove",
            "type": "object"
          }
        },
        "required": [
          "metadata"
        ],
        "type": "object"
      },
      "SessionWithMessagesResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/SessionResponse"
          },
          {
            "properties": {
              "messages": {
                "description": "All messages in the session",
                "items": {
                  "$ref": "#/components/schemas/SessionMessageResponse"
                },
                "type": "array"
              }
            },
            "required": [
              "messages"
            ],
            "type": "object"
          }
        ],
        "description": "A session with its full message history.",
        "type": "object"
      },
      "Sha256Hash": {
        "description": "SHA-256 hash (64 hex characters).",
        "maxLength": 64,
        "minLength": 64,
        "pattern": "^[a-f0-9]{64}$",
        "type": "string"
      },
      "Subscription": {
        "properties": {
          "billing_provider": {
            "$ref": "#/components/schemas/BillingProvider"
          },
          "billing_subscription_id": {
            "description": "Billing subscription ID from the provider",
            "type": "string"
          },
          "created_at": {
            "format": "date-time",
            "type": "string"
          },
          "current_period_end": {
            "description": "End of the current billing period",
            "format": "date-time",
            "type": "string"
          },
          "current_period_start": {
            "description": "Start of the current billing period",
            "format": "date-time",
            "type": "string"
          },
          "customer_id": {
            "format": "uuid",
            "type": "string"
          },
          "id": {
            "format": "uuid",
            "type": "string"
          },
          "project_id": {
            "format": "uuid",
            "type": "string"
          },
          "subscription_status": {
            "$ref": "#/components/schemas/SubscriptionStatusKind"
          },
          "tier_code": {
            "$ref": "#/components/schemas/TierCode"
          },
          "tier_id": {
            "format": "uuid",
            "type": "string"
          },
          "updated_at": {
            "format": "date-time",
            "type": "string"
          }
        },
        "type": "object"
      },
      "SubscriptionStatus": {
        "description": "Subscription status for a customer.",
        "properties": {
          "active": {
            "description": "Whether the subscription is currently active",
            "type": "boolean"
          },
          "current_period_end": {
            "description": "End of the current billing period",
            "format": "date-time",
            "type": "string"
          },
          "current_period_start": {
            "description": "Start of the current billing period",
            "format": "date-time",
            "type": "string"
          },
          "status": {
            "$ref": "#/components/schemas/SubscriptionStatusKind"
          },
          "subscription_id": {
            "description": "Stripe subscription ID",
            "type": "string"
          }
        },
        "required": [
          "active"
        ],
        "type": "object"
      },
      "SubscriptionStatusKind": {
        "description": "Subscription status (active, past_due, canceled, etc.)",
        "enum": [
          "active",
          "trialing",
          "past_due",
          "canceled",
          "unpaid",
          "incomplete",
          "incomplete_expired",
          "paused"
        ],
        "type": "string",
        "x-rust-type": {
          "crate": "modelrelay",
          "path": "modelrelay::SubscriptionStatusKind",
          "version": "0.1"
        }
      },
      "Tier": {
        "properties": {
          "billing_mode": {
            "$ref": "#/components/schemas/TierBillingMode"
          },
          "billing_price_ref": {
            "description": "Billing provider price reference for this tier",
            "type": "string"
          },
          "billing_provider": {
            "$ref": "#/components/schemas/BillingProvider"
          },
          "created_at": {
            "format": "date-time",
            "type": "string"
          },
          "display_name": {
            "description": "Human-readable tier name",
            "maxLength": 255,
            "minLength": 1,
            "type": "string"
          },
          "id": {
            "format": "uuid",
            "type": "string"
          },
          "models": {
            "items": {
              "$ref": "#/components/schemas/TierModel"
            },
            "minItems": 1,
            "type": "array"
          },
          "price_amount_cents": {
            "description": "Subscription price amount in cents",
            "format": "uint64",
            "minimum": 0,
            "type": "integer"
          },
          "price_currency": {
            "description": "Currency code for the price (e.g., 'usd')",
            "type": "string"
          },
          "price_interval": {
            "$ref": "#/components/schemas/PriceInterval"
          },
          "project_id": {
            "format": "uuid",
            "type": "string"
          },
          "spend_limit_cents": {
            "description": "Monthly spend limit in cents (e.g., 2000 = $20/month). Must be non-negative.",
            "format": "uint64",
            "minimum": 0,
            "type": "integer"
          },
          "tier_code": {
            "$ref": "#/components/schemas/TierCode"
          },
          "trial_days": {
            "description": "Number of trial days for new subscriptions",
            "format": "uint32",
            "minimum": 0,
            "type": "integer"
          },
          "updated_at": {
            "format": "date-time",
            "type": "string"
          }
        },
        "type": "object"
      },
      "TierBillingMode": {
        "description": "Billing mode for a tier. 'subscription' uses monthly spend limits; 'paygo' uses prepaid balances.",
        "enum": [
          "subscription",
          "paygo"
        ],
        "type": "string"
      },
      "TierCode": {
        "description": "Tier code identifier (e.g., free, pro, enterprise).",
        "maxLength": 64,
        "minLength": 1,
        "pattern": "^[a-z][a-z0-9_-]*$",
        "type": "string"
      },
      "TierCreate": {
        "properties": {
          "billing_mode": {
            "$ref": "#/components/schemas/TierBillingMode"
          },
          "billing_provider": {
            "$ref": "#/components/schemas/BillingProvider"
          },
          "display_name": {
            "description": "Human-readable tier name",
            "maxLength": 255,
            "minLength": 1,
            "type": "string"
          },
          "models": {
            "items": {
              "$ref": "#/components/schemas/TierModelCreate"
            },
            "minItems": 1,
            "type": "array"
          },
          "price_amount_cents": {
            "description": "Subscription price amount in cents (paid tiers)",
            "format": "uint64",
            "minimum": 0,
            "type": "integer"
          },
          "price_interval": {
            "$ref": "#/components/schemas/PriceInterval"
          },
          "spend_limit_cents": {
            "description": "Monthly spend limit in cents (e.g., 2000 = $20/month). Must be non-negative.",
            "format": "uint64",
            "minimum": 0,
            "type": "integer"
          },
          "tier_code": {
            "$ref": "#/components/schemas/TierCode"
          },
          "trial_days": {
            "description": "Number of trial days for new subscriptions (paid tiers)",
            "format": "uint32",
            "minimum": 0,
            "type": "integer"
          }
        },
        "required": [
          "tier_code",
          "display_name",
          "spend_limit_cents",
          "models"
        ],
        "type": "object"
      },
      "TierModel": {
        "properties": {
          "capabilities": {
            "description": "Workflow-critical capability flags for the model",
            "items": {
              "$ref": "#/components/schemas/ModelCapability"
            },
            "type": "array"
          },
          "context_window": {
            "description": "Maximum supported context window in tokens (if known)",
            "format": "int32",
            "minimum": 0,
            "type": "integer"
          },
          "created_at": {
            "format": "date-time",
            "type": "string"
          },
          "deprecated": {
            "description": "Whether the model is deprecated",
            "type": "boolean"
          },
          "description": {
            "description": "Human-friendly description of what the model is good at",
            "type": "string"
          },
          "id": {
            "format": "uuid",
            "type": "string"
          },
          "is_default": {
            "description": "Whether this is the default model for the tier",
            "type": "boolean"
          },
          "max_output_tokens": {
            "description": "Maximum supported output tokens (if known)",
            "format": "int32",
            "minimum": 0,
            "type": "integer"
          },
          "model_display_name": {
            "description": "Human-friendly model name resolved from pricing (e.g., 'GPT-4o Mini')",
            "type": "string"
          },
          "model_id": {
            "$ref": "#/components/schemas/ModelId"
          },
          "model_input_cost_cents": {
            "description": "Provider input cost in cents per million tokens. Customer price is derived as cost * (1 + platformFeePercent/100).",
            "format": "int64",
            "minimum": 0,
            "type": "integer"
          },
          "model_output_cost_cents": {
            "description": "Provider output cost in cents per million tokens. Customer price is derived as cost * (1 + platformFeePercent/100).",
            "format": "int64",
            "minimum": 0,
            "type": "integer"
          },
          "tier_id": {
            "format": "uuid",
            "type": "string"
          },
          "updated_at": {
            "format": "date-time",
            "type": "string"
          }
        },
        "required": [
          "id",
          "tier_id",
          "model_id",
          "model_display_name",
          "description",
          "capabilities",
          "context_window",
          "max_output_tokens",
          "deprecated",
          "model_input_cost_cents",
          "model_output_cost_cents",
          "is_default",
          "created_at",
          "updated_at"
        ],
        "type": "object"
      },
      "TierModelCreate": {
        "description": "Model to add to a tier. Pricing is derived from the model_pricing table.",
        "properties": {
          "is_default": {
            "default": false,
            "type": "boolean"
          },
          "model_id": {
            "$ref": "#/components/schemas/ModelId"
          }
        },
        "required": [
          "model_id"
        ],
        "type": "object"
      },
      "TierUpdate": {
        "properties": {
          "billing_provider": {
            "$ref": "#/components/schemas/BillingProvider"
          },
          "display_name": {
            "description": "Human-readable tier name",
            "maxLength": 255,
            "minLength": 1,
            "type": "string"
          },
          "models": {
            "items": {
              "$ref": "#/components/schemas/TierModelCreate"
            },
            "minItems": 1,
            "type": "array"
          },
          "price_amount_cents": {
            "description": "Subscription price amount in cents (paid tiers)",
            "format": "uint64",
            "minimum": 0,
            "type": "integer"
          },
          "price_interval": {
            "$ref": "#/components/schemas/PriceInterval"
          },
          "spend_limit_cents": {
            "description": "Monthly spend limit in cents (e.g., 2000 = $20/month). Must be non-negative.",
            "format": "uint64",
            "minimum": 0,
            "type": "integer"
          },
          "tier_code": {
            "$ref": "#/components/schemas/TierCode"
          },
          "trial_days": {
            "description": "Number of trial days for new subscriptions (paid tiers)",
            "format": "uint32",
            "minimum": 0,
            "type": "integer"
          }
        },
        "required": [
          "tier_code",
          "display_name",
          "spend_limit_cents"
        ],
        "type": "object"
      },
      "Tool": {
        "properties": {
          "code_execution": {
            "additionalProperties": true,
            "type": "object"
          },
          "function": {
            "properties": {
              "description": {
                "type": "string"
              },
              "name": {
                "$ref": "#/components/schemas/ToolName"
              },
              "parameters": {
                "additionalProperties": true,
                "type": "object"
              }
            },
            "type": "object"
          },
          "image_generation": {
            "description": "Configuration for server-side image generation tool",
            "properties": {
              "model": {
                "description": "Image generation model ID (e.g., gemini-2.5-flash-image)",
                "type": "string"
              }
            },
            "required": [
              "model"
            ],
            "type": "object"
          },
          "type": {
            "enum": [
              "function",
              "web",
              "x_search",
              "code_execution",
              "image_generation"
            ],
            "type": "string"
          },
          "web": {
            "additionalProperties": true,
            "type": "object"
          },
          "x_search": {
            "additionalProperties": true,
            "type": "object"
          }
        },
        "required": [
          "type"
        ],
        "type": "object"
      },
      "ToolCall": {
        "properties": {
          "function": {
            "properties": {
              "arguments": {
                "description": "JSON string of function arguments",
                "type": "string"
              },
              "name": {
                "$ref": "#/components/schemas/ToolName"
              }
            },
            "type": "object"
          },
          "id": {
            "$ref": "#/components/schemas/ToolCallId"
          },
          "type": {
            "enum": [
              "function",
              "web",
              "x_search",
              "code_execution",
              "image_generation"
            ],
            "type": "string"
          }
        },
        "required": [
          "id",
          "type"
        ],
        "type": "object"
      },
      "ToolCallDelta": {
        "description": "Incremental tool call data during streaming",
        "properties": {
          "function": {
            "properties": {
              "arguments": {
                "description": "Partial JSON string",
                "type": "string"
              },
              "name": {
                "$ref": "#/components/schemas/ToolName"
              }
            },
            "type": "object"
          },
          "id": {
            "$ref": "#/components/schemas/ToolCallId"
          },
          "index": {
            "format": "uint32",
            "minimum": 0,
            "type": "integer"
          },
          "type": {
            "type": "string"
          }
        },
        "type": "object"
      },
      "ToolCallId": {
        "description": "Unique identifier for a tool call. Treated as an opaque string and must be preserved exactly.",
        "maxLength": 256,
        "minLength": 1,
        "type": "string"
      },
      "ToolChoice": {
        "properties": {
          "function": {
            "$ref": "#/components/schemas/ToolName"
          },
          "type": {
            "enum": [
              "auto",
              "required",
              "none"
            ],
            "type": "string"
          }
        },
        "required": [
          "type"
        ],
        "type": "object"
      },
      "ToolHookConfig": {
        "properties": {
          "allow_mutation": {
            "type": "boolean"
          },
          "created_at": {
            "format": "date-time",
            "type": "string"
          },
          "enabled": {
            "type": "boolean"
          },
          "endpoint_url": {
            "format": "uri",
            "type": "string"
          },
          "fail_behavior": {
            "enum": [
              "fail_closed",
              "fail_open"
            ],
            "type": "string"
          },
          "hook_type": {
            "enum": [
              "pre_tool_use",
              "post_tool_use",
              "tool_execute"
            ],
            "type": "string"
          },
          "id": {
            "format": "uuid",
            "type": "string"
          },
          "project_id": {
            "format": "uuid",
            "type": "string"
          },
          "timeout_ms": {
            "format": "int32",
            "type": "integer"
          },
          "tools_allowlist": {
            "items": {
              "type": "string"
            },
            "type": "array"
          },
          "updated_at": {
            "format": "date-time",
            "type": "string"
          }
        },
        "type": "object"
      },
      "ToolHookConfigInput": {
        "properties": {
          "allow_mutation": {
            "type": "boolean"
          },
          "enabled": {
            "type": "boolean"
          },
          "endpoint_url": {
            "format": "uri",
            "type": "string"
          },
          "fail_behavior": {
            "enum": [
              "fail_closed",
              "fail_open"
            ],
            "type": "string"
          },
          "hook_type": {
            "enum": [
              "pre_tool_use",
              "post_tool_use",
              "tool_execute"
            ],
            "type": "string"
          },
          "timeout_ms": {
            "format": "int32",
            "type": "integer"
          },
          "tools_allowlist": {
            "items": {
              "type": "string"
            },
            "type": "array"
          }
        },
        "required": [
          "hook_type",
          "endpoint_url"
        ],
        "type": "object"
      },
      "ToolHookConfigUpdate": {
        "properties": {
          "allow_mutation": {
            "type": "boolean"
          },
          "enabled": {
            "type": "boolean"
          },
          "endpoint_url": {
            "format": "uri",
            "type": "string"
          },
          "fail_behavior": {
            "enum": [
              "fail_closed",
              "fail_open"
            ],
            "type": "string"
          },
          "rotate_secret": {
            "type": "boolean"
          },
          "timeout_ms": {
            "format": "int32",
            "type": "integer"
          },
          "tools_allowlist": {
            "items": {
              "type": "string"
            },
            "type": "array"
          }
        },
        "type": "object"
      },
      "ToolHookEvent": {
        "properties": {
          "created_at": {
            "format": "date-time",
            "type": "string"
          },
          "error": {
            "type": "string"
          },
          "hook_config_id": {
            "format": "uuid",
            "type": "string"
          },
          "id": {
            "format": "uuid",
            "type": "string"
          },
          "latency_ms": {
            "format": "int32",
            "type": "integer"
          },
          "request_id": {
            "type": "string"
          },
          "response_body": {
            "type": "string"
          },
          "response_status": {
            "format": "int32",
            "type": "integer"
          },
          "status": {
            "enum": [
              "success",
              "blocked",
              "timeout",
              "error"
            ],
            "type": "string"
          },
          "tool_call_id": {
            "type": "string"
          }
        },
        "type": "object"
      },
      "ToolHookTestResult": {
        "properties": {
          "error": {
            "type": "string"
          },
          "latency_ms": {
            "format": "int32",
            "type": "integer"
          },
          "response_body": {
            "type": "string"
          },
          "response_status": {
            "format": "int32",
            "type": "integer"
          },
          "status": {
            "enum": [
              "success",
              "blocked",
              "timeout",
              "error"
            ],
            "type": "string"
          }
        },
        "type": "object"
      },
      "ToolName": {
        "description": "Tool identifier. For tools.v0 client tools, use dot-separated lowercase segments (e.g. fs.search).",
        "maxLength": 128,
        "minLength": 1,
        "pattern": "^[a-z][a-z0-9_]*(\\\\.[a-z][a-z0-9_]*)*$",
        "type": "string"
      },
      "Usage": {
        "description": "Token usage statistics. All fields default to 0 if not present.",
        "properties": {
          "input_tokens": {
            "default": 0,
            "format": "uint64",
            "minimum": 0,
            "type": "integer"
          },
          "output_tokens": {
            "default": 0,
            "format": "uint64",
            "minimum": 0,
            "type": "integer"
          },
          "total_tokens": {
            "default": 0,
            "format": "uint64",
            "minimum": 0,
            "type": "integer"
          }
        },
        "type": "object"
      },
      "User": {
        "properties": {
          "email": {
            "format": "email",
            "type": "string"
          },
          "id": {
            "format": "uuid",
            "type": "string"
          },
          "project_id": {
            "format": "uuid",
            "type": "string"
          }
        },
        "type": "object"
      },
      "WebhookConfig": {
        "properties": {
          "created_at": {
            "format": "date-time",
            "type": "string"
          },
          "enabled": {
            "type": "boolean"
          },
          "endpoint_url": {
            "format": "uri",
            "type": "string"
          },
          "events": {
            "items": {
              "enum": [
                "customer.created",
                "customer.updated",
                "customer.deleted",
                "usage.threshold_exceeded",
                "request.completed",
                "billing.subscription_changed"
              ],
              "type": "string"
            },
            "type": "array"
          },
          "id": {
            "format": "uuid",
            "type": "string"
          },
          "project_id": {
            "format": "uuid",
            "type": "string"
          },
          "signing_secret": {
            "type": "string"
          },
          "updated_at": {
            "format": "date-time",
            "type": "string"
          }
        },
        "type": "object"
      },
      "WebhookConfigInput": {
        "properties": {
          "enabled": {
            "type": "boolean"
          },
          "endpoint_url": {
            "format": "uri",
            "type": "string"
          },
          "events": {
            "items": {
              "enum": [
                "customer.created",
                "customer.updated",
                "customer.deleted",
                "usage.threshold_exceeded",
                "request.completed",
                "billing.subscription_changed"
              ],
              "type": "string"
            },
            "type": "array"
          }
        },
        "required": [
          "endpoint_url",
          "events"
        ],
        "type": "object"
      },
      "WebhookConfigUpdate": {
        "properties": {
          "enabled": {
            "type": "boolean"
          },
          "endpoint_url": {
            "format": "uri",
            "type": "string"
          },
          "events": {
            "items": {
              "enum": [
                "customer.created",
                "customer.updated",
                "customer.deleted",
                "usage.threshold_exceeded",
                "request.completed",
                "billing.subscription_changed"
              ],
              "type": "string"
            },
            "type": "array"
          },
          "rotate_secret": {
            "type": "boolean"
          }
        },
        "required": [
          "endpoint_url",
          "events"
        ],
        "type": "object"
      },
      "WebhookTestResult": {
        "properties": {
          "error": {
            "type": "string"
          },
          "latency_ms": {
            "format": "int32",
            "type": "integer"
          },
          "response_body": {
            "type": "string"
          },
          "response_status": {
            "format": "int32",
            "type": "integer"
          },
          "status": {
            "enum": [
              "delivered",
              "failed"
            ],
            "type": "string"
          }
        },
        "type": "object"
      },
      "WorkflowSpecV1": {
        "additionalProperties": true,
        "description": "A `workflow.v1` spec. The canonical JSON Schema is available at `/schemas/workflow_v1.schema.json`.",
        "type": "object"
      }
    },
    "securitySchemes": {
      "apiKeyAuth": {
        "in": "header",
        "name": "X-ModelRelay-Api-Key",
        "type": "apiKey"
      },
      "bearerAuth": {
        "bearerFormat": "JWT",
        "scheme": "bearer",
        "type": "http"
      }
    }
  },
  "info": {
    "description": "Control-plane and inference endpoints for ModelRelay projects, tiers, customers, billing, and LLM proxying.",
    "title": "ModelRelay API",
    "version": "0.7.0"
  },
  "openapi": "3.0.3",
  "paths": {
    "/auth/customer-token": {
      "post": {
        "description": "Used by trusted backends to mint short-lived customer-scoped bearer tokens\nfor data-plane access (/responses, /runs). Requires a secret API key (mr_sk_*).\nThe customer must already exist; use /customers endpoints to create customers first.\n",
        "operationId": "mintCustomerToken",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "customer_external_id": {
                    "description": "External customer identifier (provide exactly one of customer_id or customer_external_id)",
                    "type": "string"
                  },
                  "customer_id": {
                    "description": "Internal customer UUID (provide exactly one of customer_id or customer_external_id)",
                    "format": "uuid",
                    "type": "string"
                  },
                  "ttl_seconds": {
                    "description": "Requested token TTL in seconds (server may cap this)",
                    "format": "uint32",
                    "minimum": 1,
                    "type": "integer"
                  }
                },
                "type": "object"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CustomerTokenResponse"
                }
              }
            },
            "description": "Customer token issued"
          },
          "400": {
            "description": "Invalid request (missing or invalid customer selector)"
          },
          "401": {
            "description": "Invalid or missing secret key"
          },
          "404": {
            "description": "Customer not found"
          }
        },
        "security": [
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "Mint a customer-scoped bearer token"
      }
    },
    "/auth/login": {
      "post": {
        "operationId": "login",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "email": {
                    "format": "email",
                    "type": "string"
                  },
                  "password": {
                    "type": "string"
                  }
                },
                "type": "object"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthResponse"
                }
              }
            },
            "description": "Tokens issued"
          }
        },
        "summary": "Exchange credentials for tokens"
      }
    },
    "/auth/logout": {
      "post": {
        "operationId": "logout",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "refresh_token": {
                    "type": "string"
                  }
                },
                "type": "object"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "Session revoked"
          }
        },
        "summary": "Revoke a refresh token"
      }
    },
    "/auth/me": {
      "get": {
        "operationId": "getAuthenticatedUser",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "user": {
                      "$ref": "#/components/schemas/User"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Current user"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Fetch the authenticated user profile"
      }
    },
    "/auth/refresh": {
      "post": {
        "operationId": "refreshToken",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "refresh_token": {
                    "type": "string"
                  }
                },
                "type": "object"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthTokens"
                }
              }
            },
            "description": "Tokens refreshed"
          }
        },
        "summary": "Refresh an access token"
      }
    },
    "/auth/register": {
      "post": {
        "operationId": "registerOwner",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "billing_provider": {
                    "$ref": "#/components/schemas/BillingProvider"
                  },
                  "email": {
                    "format": "email",
                    "type": "string"
                  },
                  "password": {
                    "type": "string"
                  }
                },
                "type": "object"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthResponse"
                }
              }
            },
            "description": "User created"
          }
        },
        "summary": "Register a new owner account"
      }
    },
    "/customers": {
      "get": {
        "operationId": "listCustomers",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "customers": {
                      "items": {
                        "$ref": "#/components/schemas/CustomerWithSubscription"
                      },
                      "type": "array"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Customer list"
          }
        },
        "security": [
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "List customers"
      },
      "post": {
        "operationId": "createProjectCustomer",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CustomerCreate"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "customer": {
                      "$ref": "#/components/schemas/CustomerWithSubscription"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Customer created"
          }
        },
        "security": [
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "Create a customer"
      },
      "put": {
        "operationId": "upsertCustomer",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CustomerCreate"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "customer": {
                      "$ref": "#/components/schemas/CustomerWithSubscription"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Customer updated"
          },
          "201": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "customer": {
                      "$ref": "#/components/schemas/CustomerWithSubscription"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Customer created"
          }
        },
        "security": [
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "Upsert a customer by external_id"
      }
    },
    "/customers/me": {
      "get": {
        "description": "Returns the current customer associated with the provided customer-scoped bearer token.\nIncludes the customer's subscription and tier when available.\n",
        "operationId": "getCustomerMe",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CustomerMeResponse"
                }
              }
            },
            "description": "Customer details"
          },
          "401": {
            "description": "Unauthorized"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Get the authenticated customer"
      }
    },
    "/customers/me/balance": {
      "get": {
        "operationId": "getCustomerMeBalance",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CustomerBalanceResponse"
                }
              }
            },
            "description": "PAYGO balance"
          },
          "400": {
            "description": "Subscription is not PAYGO"
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "Customer or subscription not found"
          },
          "503": {
            "description": "Service unavailable"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Get the authenticated customer's PAYGO balance"
      }
    },
    "/customers/me/balance/history": {
      "get": {
        "operationId": "getCustomerMeBalanceHistory",
        "parameters": [
          {
            "in": "query",
            "name": "limit",
            "required": false,
            "schema": {
              "format": "int32",
              "maximum": 200,
              "minimum": 1,
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "offset",
            "required": false,
            "schema": {
              "format": "int32",
              "minimum": 0,
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CustomerLedgerResponse"
                }
              }
            },
            "description": "Ledger entries"
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "Customer not found"
          },
          "503": {
            "description": "Service unavailable"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Get the authenticated customer's PAYGO ledger history"
      }
    },
    "/customers/me/change-tier": {
      "post": {
        "description": "Allows customers to upgrade or downgrade their subscription tier. Supports paid-to-paid (with proration), free-to-paid (requires payment method on file), paid-to-free (cancels at period end), and free-to-free transitions.",
        "operationId": "changeCustomerMeTier",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ChangeTierRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CustomerMeSubscriptionResponse"
                }
              }
            },
            "description": "Tier changed successfully"
          },
          "400": {
            "description": "Invalid request (missing tier_code, same tier, or PAYGO subscription)"
          },
          "401": {
            "description": "Unauthorized"
          },
          "402": {
            "description": "No payment method on file (required for free-to-paid upgrade)"
          },
          "404": {
            "description": "Customer or tier not found"
          },
          "409": {
            "description": "Billing provider mismatch"
          },
          "503": {
            "description": "Service unavailable"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Change the authenticated customer's subscription tier"
      }
    },
    "/customers/me/checkout": {
      "post": {
        "description": "Creates a Stripe checkout session using the customer-first flow. A Stripe Customer is created with the verified OAuth email before checkout, preventing email spoofing. The email field in the Stripe checkout will be locked to the authenticated user's email.",
        "operationId": "createCustomerMeCheckout",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CustomerMeCheckoutRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CheckoutSessionResponse"
                }
              }
            },
            "description": "Checkout session created successfully"
          },
          "400": {
            "description": "Invalid request (missing or invalid tier_code, success_url, or cancel_url)"
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "Customer or tier not found"
          },
          "409": {
            "description": "Tier has no billing pricing configured"
          },
          "503": {
            "description": "Billing not configured"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Create a checkout session for the authenticated customer"
      }
    },
    "/customers/me/subscription": {
      "get": {
        "description": "Returns customer-visible subscription details for the authenticated customer bearer token.\nIncludes tier name and subscription price; does not include developer-private usage cost accounting.\n",
        "operationId": "getCustomerMeSubscription",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CustomerMeSubscriptionResponse"
                }
              }
            },
            "description": "Subscription details"
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "Customer or tier not found"
          },
          "500": {
            "description": "Internal server error"
          },
          "503": {
            "description": "Service unavailable"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Get the authenticated customer's subscription"
      }
    },
    "/customers/me/topup": {
      "post": {
        "operationId": "createCustomerMeTopup",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CustomerTopupRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CustomerTopupResponse"
                }
              }
            },
            "description": "Checkout session created"
          },
          "400": {
            "description": "Invalid request"
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "Customer not found"
          },
          "503": {
            "description": "Service unavailable"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Create a PAYGO top-up checkout session for the authenticated customer"
      }
    },
    "/customers/me/usage": {
      "get": {
        "description": "Returns customer-visible usage metrics for the current billing window.\nIncludes request/token counts and (for paid tiers) remaining subscription credits.\nDoes not include any developer-private budgets (e.g., internal tier spend caps).\n",
        "operationId": "getCustomerMeUsage",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CustomerMeUsageResponse"
                }
              }
            },
            "description": "Usage summary"
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "Customer not found"
          },
          "500": {
            "description": "Failed to calculate usage"
          },
          "503": {
            "description": "Service unavailable"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Get the authenticated customer's usage"
      }
    },
    "/customers/{customer_id}": {
      "delete": {
        "operationId": "deleteProjectCustomer",
        "responses": {
          "204": {
            "description": "Customer deleted"
          },
          "404": {
            "description": "Customer not found"
          }
        },
        "security": [
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "Delete a customer"
      },
      "get": {
        "operationId": "getCustomer",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "customer": {
                      "$ref": "#/components/schemas/CustomerWithSubscription"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Customer"
          },
          "404": {
            "description": "Customer not found"
          }
        },
        "security": [
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "Get a customer"
      },
      "parameters": [
        {
          "in": "path",
          "name": "customer_id",
          "required": true,
          "schema": {
            "format": "uuid",
            "type": "string"
          }
        }
      ]
    },
    "/customers/{customer_id}/balance": {
      "get": {
        "operationId": "getCustomerBalance",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CustomerBalanceResponse"
                }
              }
            },
            "description": "PAYGO balance"
          },
          "400": {
            "description": "Subscription is not PAYGO"
          },
          "404": {
            "description": "Customer or subscription not found"
          },
          "503": {
            "description": "Service unavailable"
          }
        },
        "security": [
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "Get a customer's PAYGO balance"
      },
      "parameters": [
        {
          "in": "path",
          "name": "customer_id",
          "required": true,
          "schema": {
            "format": "uuid",
            "type": "string"
          }
        }
      ]
    },
    "/customers/{customer_id}/balance/history": {
      "get": {
        "operationId": "getCustomerBalanceHistory",
        "parameters": [
          {
            "in": "query",
            "name": "limit",
            "required": false,
            "schema": {
              "format": "int32",
              "maximum": 200,
              "minimum": 1,
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "offset",
            "required": false,
            "schema": {
              "format": "int32",
              "minimum": 0,
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CustomerLedgerResponse"
                }
              }
            },
            "description": "Ledger entries"
          },
          "404": {
            "description": "Customer not found"
          },
          "503": {
            "description": "Service unavailable"
          }
        },
        "security": [
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "Get a customer's PAYGO ledger history"
      },
      "parameters": [
        {
          "in": "path",
          "name": "customer_id",
          "required": true,
          "schema": {
            "format": "uuid",
            "type": "string"
          }
        }
      ]
    },
    "/customers/{customer_id}/subscribe": {
      "parameters": [
        {
          "in": "path",
          "name": "customer_id",
          "required": true,
          "schema": {
            "format": "uuid",
            "type": "string"
          }
        }
      ],
      "post": {
        "operationId": "subscribeCustomer",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "cancel_url": {
                    "format": "uri",
                    "type": "string"
                  },
                  "success_url": {
                    "format": "uri",
                    "type": "string"
                  },
                  "tier_id": {
                    "format": "uuid",
                    "type": "string"
                  }
                },
                "required": [
                  "tier_id",
                  "success_url",
                  "cancel_url"
                ],
                "type": "object"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CheckoutSessionResponse"
                }
              }
            },
            "description": "Checkout session created"
          }
        },
        "security": [
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "Create a customer subscription checkout session"
      }
    },
    "/customers/{customer_id}/subscription": {
      "delete": {
        "operationId": "cancelCustomerSubscription",
        "responses": {
          "204": {
            "description": "Subscription canceled"
          }
        },
        "security": [
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "Cancel a customer's subscription"
      },
      "get": {
        "operationId": "getCustomerSubscription",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "subscription": {
                      "$ref": "#/components/schemas/Subscription"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Subscription details"
          },
          "404": {
            "description": "Subscription not found"
          }
        },
        "security": [
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "Get a customer's subscription"
      },
      "parameters": [
        {
          "in": "path",
          "name": "customer_id",
          "required": true,
          "schema": {
            "format": "uuid",
            "type": "string"
          }
        }
      ]
    },
    "/customers/{customer_id}/topup": {
      "parameters": [
        {
          "in": "path",
          "name": "customer_id",
          "required": true,
          "schema": {
            "format": "uuid",
            "type": "string"
          }
        }
      ],
      "post": {
        "operationId": "createCustomerTopup",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CustomerTopupRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CustomerTopupResponse"
                }
              }
            },
            "description": "Checkout session created"
          },
          "400": {
            "description": "Invalid request"
          },
          "404": {
            "description": "Customer not found"
          },
          "503": {
            "description": "Service unavailable"
          }
        },
        "security": [
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "Create a PAYGO top-up checkout session for a customer"
      }
    },
    "/images/generate": {
      "post": {
        "description": "Generate images using AI models. Returns URLs by default (requires storage configuration) or base64-encoded data when response_format is 'b64_json'.",
        "operationId": "generateImage",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ImageRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ImageResponse"
                }
              }
            },
            "description": "Generated images"
          }
        },
        "security": [
          {
            "bearerAuth": []
          },
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "Generate images from a text prompt"
      }
    },
    "/images/{image_id}": {
      "get": {
        "description": "Retrieve information about a specific image, including its pinned status and URL.",
        "operationId": "getImage",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ImagePinResponse"
                }
              }
            },
            "description": "Image details"
          },
          "404": {
            "description": "Image not found"
          }
        },
        "security": [
          {
            "bearerAuth": []
          },
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "Get image details"
      },
      "parameters": [
        {
          "description": "Image ID",
          "in": "path",
          "name": "image_id",
          "required": true,
          "schema": {
            "format": "uuid",
            "type": "string"
          }
        }
      ]
    },
    "/images/{image_id}/pin": {
      "delete": {
        "description": "Unpin an image, setting it to expire after the default ephemeral period (7 days).",
        "operationId": "unpinImage",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ImagePinResponse"
                }
              }
            },
            "description": "Image unpinned successfully"
          },
          "404": {
            "description": "Image not found"
          }
        },
        "security": [
          {
            "bearerAuth": []
          },
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "Unpin an image"
      },
      "parameters": [
        {
          "description": "Image ID",
          "in": "path",
          "name": "image_id",
          "required": true,
          "schema": {
            "format": "uuid",
            "type": "string"
          }
        }
      ],
      "post": {
        "description": "Pin an image to prevent it from expiring. Pinned images remain accessible permanently (subject to tier limits).",
        "operationId": "pinImage",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ImagePinResponse"
                }
              }
            },
            "description": "Image pinned successfully"
          },
          "403": {
            "description": "Quota exceeded"
          },
          "404": {
            "description": "Image not found"
          },
          "410": {
            "description": "Image has expired"
          }
        },
        "security": [
          {
            "bearerAuth": []
          },
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "Pin an image"
      }
    },
    "/models": {
      "get": {
        "description": "Returns all active models with rich metadata for building model selectors.",
        "operationId": "listModels",
        "parameters": [
          {
            "description": "Filter results to a specific provider",
            "in": "query",
            "name": "provider",
            "required": false,
            "schema": {
              "$ref": "#/components/schemas/ProviderId"
            }
          },
          {
            "description": "Filter results to models that support a capability",
            "in": "query",
            "name": "capability",
            "required": false,
            "schema": {
              "$ref": "#/components/schemas/ModelCapability"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ModelsResponse"
                }
              }
            },
            "description": "Models list"
          }
        },
        "summary": "List active models"
      }
    },
    "/projects": {
      "get": {
        "operationId": "listProjects",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "projects": {
                      "items": {
                        "$ref": "#/components/schemas/Project"
                      },
                      "type": "array"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Project list"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "List projects for the authenticated owner"
      },
      "post": {
        "operationId": "createProject",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "description": {
                    "type": "string"
                  },
                  "markup_percentage": {
                    "maximum": 100,
                    "minimum": 0,
                    "type": "number"
                  },
                  "name": {
                    "type": "string"
                  }
                },
                "type": "object"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "project": {
                      "$ref": "#/components/schemas/Project"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Project created"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Create a project"
      }
    },
    "/projects/{id}": {
      "delete": {
        "operationId": "deleteProject",
        "responses": {
          "204": {
            "description": "Project deleted"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Delete a project"
      },
      "get": {
        "operationId": "getProject",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "project": {
                      "$ref": "#/components/schemas/Project"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Project found"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Get a project"
      },
      "parameters": [
        {
          "$ref": "#/components/parameters/ProjectID"
        }
      ],
      "put": {
        "operationId": "updateProject",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "billing_mode": {
                    "$ref": "#/components/schemas/BillingMode"
                  },
                  "description": {
                    "type": "string"
                  },
                  "markup_percentage": {
                    "maximum": 100,
                    "minimum": 0,
                    "type": "number"
                  },
                  "name": {
                    "type": "string"
                  }
                },
                "type": "object"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "project": {
                      "$ref": "#/components/schemas/Project"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Project updated"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Update a project"
      }
    },
    "/projects/{id}/customers": {
      "get": {
        "operationId": "listProjectCustomers",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "customers": {
                      "items": {
                        "$ref": "#/components/schemas/CustomerWithSubscription"
                      },
                      "type": "array"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Customer list"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "List customers for a project"
      },
      "parameters": [
        {
          "$ref": "#/components/parameters/ProjectID"
        }
      ],
      "post": {
        "operationId": "createCustomer",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CustomerCreate"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "customer": {
                      "$ref": "#/components/schemas/CustomerWithSubscription"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Customer created"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Create a customer"
      }
    },
    "/projects/{id}/customers/{customer_id}": {
      "delete": {
        "operationId": "deleteCustomer",
        "responses": {
          "204": {
            "description": "Customer deleted"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Delete a customer"
      },
      "parameters": [
        {
          "$ref": "#/components/parameters/ProjectID"
        },
        {
          "in": "path",
          "name": "customer_id",
          "required": true,
          "schema": {
            "format": "uuid",
            "type": "string"
          }
        }
      ]
    },
    "/projects/{id}/tiers": {
      "get": {
        "operationId": "listProjectTiers",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "tiers": {
                      "items": {
                        "$ref": "#/components/schemas/Tier"
                      },
                      "type": "array"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Tier list"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "List tiers for a project"
      },
      "parameters": [
        {
          "$ref": "#/components/parameters/ProjectID"
        }
      ],
      "post": {
        "operationId": "createTier",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TierCreate"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "tier": {
                      "$ref": "#/components/schemas/Tier"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Tier created"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Create a tier"
      }
    },
    "/projects/{id}/tiers/{tier_id}": {
      "delete": {
        "operationId": "deleteTier",
        "responses": {
          "204": {
            "description": "Tier deleted"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Delete a tier"
      },
      "parameters": [
        {
          "$ref": "#/components/parameters/ProjectID"
        },
        {
          "in": "path",
          "name": "tier_id",
          "required": true,
          "schema": {
            "format": "uuid",
            "type": "string"
          }
        }
      ],
      "put": {
        "operationId": "updateTier",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TierUpdate"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Tier updated"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Update a tier"
      }
    },
    "/projects/{id}/tool-hooks": {
      "get": {
        "operationId": "listProjectToolHooks",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "hooks": {
                      "items": {
                        "$ref": "#/components/schemas/ToolHookConfig"
                      },
                      "type": "array"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Tool hook list"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "List project tool hooks"
      },
      "parameters": [
        {
          "$ref": "#/components/parameters/ProjectID"
        }
      ],
      "post": {
        "operationId": "createProjectToolHook",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ToolHookConfigInput"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "hook": {
                      "$ref": "#/components/schemas/ToolHookConfig"
                    },
                    "signing_secret": {
                      "type": "string"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Tool hook created"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Create a project tool hook"
      }
    },
    "/projects/{id}/tool-hooks/{hook_id}": {
      "delete": {
        "operationId": "deleteProjectToolHook",
        "responses": {
          "204": {
            "description": "Tool hook deleted"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Delete a project tool hook"
      },
      "get": {
        "operationId": "getProjectToolHook",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "hook": {
                      "$ref": "#/components/schemas/ToolHookConfig"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Tool hook details"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Get a project tool hook"
      },
      "parameters": [
        {
          "$ref": "#/components/parameters/ProjectID"
        },
        {
          "$ref": "#/components/parameters/ToolHookID"
        }
      ],
      "put": {
        "operationId": "updateProjectToolHook",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ToolHookConfigUpdate"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "hook": {
                      "$ref": "#/components/schemas/ToolHookConfig"
                    },
                    "signing_secret": {
                      "type": "string"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Tool hook updated"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Update a project tool hook"
      }
    },
    "/projects/{id}/tool-hooks/{hook_id}/events": {
      "get": {
        "operationId": "listProjectToolHookEvents",
        "parameters": [
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "events": {
                      "items": {
                        "$ref": "#/components/schemas/ToolHookEvent"
                      },
                      "type": "array"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Tool hook events"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "List tool hook delivery events"
      },
      "parameters": [
        {
          "$ref": "#/components/parameters/ProjectID"
        },
        {
          "$ref": "#/components/parameters/ToolHookID"
        }
      ]
    },
    "/projects/{id}/tool-hooks/{hook_id}/test": {
      "parameters": [
        {
          "$ref": "#/components/parameters/ProjectID"
        },
        {
          "$ref": "#/components/parameters/ToolHookID"
        }
      ],
      "post": {
        "operationId": "testProjectToolHook",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ToolHookTestResult"
                }
              }
            },
            "description": "Tool hook test result"
          },
          "502": {
            "description": "Tool hook test failed"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Test a tool hook"
      }
    },
    "/projects/{id}/webhooks": {
      "get": {
        "operationId": "listProjectWebhooks",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "webhooks": {
                      "items": {
                        "$ref": "#/components/schemas/WebhookConfig"
                      },
                      "type": "array"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Webhook list"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "List project webhooks"
      },
      "parameters": [
        {
          "$ref": "#/components/parameters/ProjectID"
        }
      ],
      "post": {
        "operationId": "createProjectWebhook",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/WebhookConfigInput"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "webhook": {
                      "$ref": "#/components/schemas/WebhookConfig"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Webhook created"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Create a project webhook"
      }
    },
    "/projects/{id}/webhooks/{webhook_id}": {
      "delete": {
        "operationId": "deleteProjectWebhook",
        "responses": {
          "204": {
            "description": "Webhook deleted"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Delete a project webhook"
      },
      "get": {
        "operationId": "getProjectWebhook",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "webhook": {
                      "$ref": "#/components/schemas/WebhookConfig"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Webhook details"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Get a project webhook"
      },
      "parameters": [
        {
          "$ref": "#/components/parameters/ProjectID"
        },
        {
          "$ref": "#/components/parameters/WebhookID"
        }
      ],
      "put": {
        "operationId": "updateProjectWebhook",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/WebhookConfigUpdate"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "webhook": {
                      "$ref": "#/components/schemas/WebhookConfig"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Webhook updated"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Update a project webhook"
      }
    },
    "/projects/{id}/webhooks/{webhook_id}/events": {
      "get": {
        "operationId": "listProjectWebhookEvents",
        "parameters": [
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "offset",
            "schema": {
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "event_type",
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "status",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "events": {
                      "items": {
                        "$ref": "#/components/schemas/OutboundWebhookEvent"
                      },
                      "type": "array"
                    },
                    "next_cursor": {
                      "type": "string"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Webhook events"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "List webhook delivery events"
      },
      "parameters": [
        {
          "$ref": "#/components/parameters/ProjectID"
        },
        {
          "$ref": "#/components/parameters/WebhookID"
        }
      ]
    },
    "/projects/{id}/webhooks/{webhook_id}/test": {
      "parameters": [
        {
          "$ref": "#/components/parameters/ProjectID"
        },
        {
          "$ref": "#/components/parameters/WebhookID"
        }
      ],
      "post": {
        "operationId": "testProjectWebhook",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "event_type": {
                    "type": "string"
                  }
                },
                "type": "object"
              }
            }
          },
          "required": false
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/WebhookTestResult"
                }
              }
            },
            "description": "Webhook test result"
          },
          "502": {
            "description": "Webhook test failed"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "summary": "Test a webhook"
      }
    },
    "/responses": {
      "post": {
        "description": "Creates a model response. Auth accepts secret API keys or bearer tokens. Bearer tokens may be owner session tokens (dashboard/server) or customer tokens; publishable keys are not allowed.",
        "operationId": "createResponse",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ResponsesRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ResponsesResponse"
                }
              }
            },
            "description": "Response"
          }
        },
        "security": [
          {
            "bearerAuth": []
          },
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "Create a response via the provider-agnostic API"
      }
    },
    "/responses:batch": {
      "post": {
        "operationId": "createResponsesBatch",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ResponsesBatchRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ResponsesBatchResponse"
                }
              }
            },
            "description": "Batch response results"
          }
        },
        "security": [
          {
            "bearerAuth": []
          },
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "Create multiple responses concurrently (batch)"
      }
    },
    "/runs": {
      "post": {
        "description": "Starts a run for a `workflow.v1` spec and returns a `run_id`. Auth matches `/responses` (API key or frontend bearer token). Session owner tokens from `/auth/login` are not accepted. Provide `session_id` to link the run to a session; when linked, assistant messages are appended to the session on completion.",
        "operationId": "createRun",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RunsCreateRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RunsCreateResponse"
                }
              }
            },
            "description": "Run created (or idempotent replay)"
          }
        },
        "security": [
          {
            "bearerAuth": []
          },
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "Start a workflow run"
      }
    },
    "/runs/{run_id}": {
      "get": {
        "description": "Returns a derived snapshot state for the run (folded from event history + artifacts), including outputs and an aggregated cost summary when available.",
        "operationId": "getRun",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RunsGetResponse"
                }
              }
            },
            "description": "Run snapshot"
          },
          "404": {
            "description": "Run not found"
          }
        },
        "security": [
          {
            "bearerAuth": []
          },
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "Get a derived run snapshot"
      },
      "parameters": [
        {
          "in": "path",
          "name": "run_id",
          "required": true,
          "schema": {
            "format": "uuid",
            "type": "string"
          }
        }
      ]
    },
    "/runs/{run_id}/events": {
      "get": {
        "description": "Streams an append-only, totally ordered history for the run. The wire format is negotiated via `Accept`: NDJSON (`application/x-ndjson`) or Server-Sent Events (`text/event-stream`). Each line/event is a `run_event` envelope; see `/schemas/run_event.schema.json` for the canonical schema.",
        "operationId": "streamRunEvents",
        "responses": {
          "200": {
            "content": {
              "application/x-ndjson": {
                "example": "{\"envelope_version\":\"v0\",\"seq\":1,\"type\":\"run_compiled\",...}\n{\"envelope_version\":\"v0\",\"seq\":2,\"type\":\"run_started\",...}\n",
                "schema": {
                  "type": "string"
                }
              },
              "text/event-stream": {
                "example": "event: run_started\nid: 2\ndata: {\"envelope_version\":\"v0\",\"seq\":2,\"type\":\"run_started\",...}\n",
                "schema": {
                  "type": "string"
                }
              }
            },
            "description": "Event stream (NDJSON or SSE)"
          }
        },
        "security": [
          {
            "bearerAuth": []
          },
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "Stream run events (append-only)"
      },
      "parameters": [
        {
          "in": "path",
          "name": "run_id",
          "required": true,
          "schema": {
            "format": "uuid",
            "type": "string"
          }
        },
        {
          "description": "Returns events where `seq > after_seq`.",
          "in": "query",
          "name": "after_seq",
          "required": false,
          "schema": {
            "format": "uint64",
            "minimum": 0,
            "type": "integer"
          }
        },
        {
          "description": "When false, returns currently available events then closes.",
          "in": "query",
          "name": "wait",
          "required": false,
          "schema": {
            "type": "boolean"
          }
        },
        {
          "description": "Maximum number of events to send before closing.",
          "in": "query",
          "name": "limit",
          "required": false,
          "schema": {
            "format": "uint32",
            "maximum": 10000,
            "minimum": 1,
            "type": "integer"
          }
        }
      ]
    },
    "/schemas/run_event.schema.json": {
      "get": {
        "description": "Returns the canonical JSON Schema (draft-07) for `run_event` (workflow run history events).",
        "operationId": "getRunEventV0Schema",
        "responses": {
          "200": {
            "content": {
              "application/schema+json": {
                "schema": {
                  "type": "object"
                }
              }
            },
            "description": "Schema document"
          }
        },
        "summary": "Get JSON Schema for run_event"
      }
    },
    "/schemas/workflow_v1.schema.json": {
      "get": {
        "description": "Returns the canonical JSON Schema (draft-07) for `workflow.v1`.",
        "operationId": "getWorkflowV1Schema",
        "responses": {
          "200": {
            "content": {
              "application/schema+json": {
                "schema": {
                  "type": "object"
                }
              }
            },
            "description": "Schema document"
          }
        },
        "summary": "Get JSON Schema for workflow.v1"
      }
    },
    "/sessions": {
      "get": {
        "description": "Returns a paginated list of sessions for the project.",
        "operationId": "listSessions",
        "parameters": [
          {
            "description": "Maximum number of sessions to return",
            "in": "query",
            "name": "limit",
            "required": false,
            "schema": {
              "default": 50,
              "format": "int32",
              "maximum": 100,
              "minimum": 1,
              "type": "integer"
            }
          },
          {
            "description": "Number of sessions to skip",
            "in": "query",
            "name": "offset",
            "required": false,
            "schema": {
              "format": "int32",
              "minimum": 0,
              "type": "integer"
            }
          },
          {
            "description": "Filter sessions by customer ID",
            "in": "query",
            "name": "customer_id",
            "required": false,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SessionListResponse"
                }
              }
            },
            "description": "Session list"
          },
          "401": {
            "description": "API key required"
          }
        },
        "security": [
          {
            "bearerAuth": []
          },
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "List sessions"
      },
      "post": {
        "description": "Creates a new session for multi-turn conversation management. Sessions persist message history on the server for cross-device continuity.",
        "operationId": "createSession",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SessionCreateRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SessionResponse"
                }
              }
            },
            "description": "Session created"
          },
          "400": {
            "description": "Invalid request"
          },
          "401": {
            "description": "API key required"
          }
        },
        "security": [
          {
            "bearerAuth": []
          },
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "Create a new session"
      }
    },
    "/sessions/{session_id}": {
      "delete": {
        "description": "Deletes a session and all its messages. Requires a secret API key (mr_sk_*).",
        "operationId": "deleteSession",
        "responses": {
          "204": {
            "description": "Session deleted"
          },
          "403": {
            "description": "Secret key required for deletion"
          },
          "404": {
            "description": "Session not found"
          }
        },
        "security": [
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "Delete a session"
      },
      "get": {
        "description": "Returns a session including its full message history.",
        "operationId": "getSession",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SessionWithMessagesResponse"
                }
              }
            },
            "description": "Session with messages"
          },
          "404": {
            "description": "Session not found"
          }
        },
        "security": [
          {
            "bearerAuth": []
          },
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "Get session with messages"
      },
      "parameters": [
        {
          "in": "path",
          "name": "session_id",
          "required": true,
          "schema": {
            "format": "uuid",
            "type": "string"
          }
        }
      ],
      "patch": {
        "description": "Updates session metadata. Keys with null values are removed.",
        "operationId": "updateSession",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SessionUpdateRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SessionResponse"
                }
              }
            },
            "description": "Session updated"
          },
          "400": {
            "description": "Invalid request"
          },
          "401": {
            "description": "API key required"
          },
          "404": {
            "description": "Session not found"
          }
        },
        "security": [
          {
            "bearerAuth": []
          },
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "Update session metadata"
      }
    },
    "/sessions/{session_id}/clear": {
      "parameters": [
        {
          "in": "path",
          "name": "session_id",
          "required": true,
          "schema": {
            "format": "uuid",
            "type": "string"
          }
        }
      ],
      "post": {
        "description": "Deletes all messages in the session and returns the updated session.",
        "operationId": "clearSession",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SessionResponse"
                }
              }
            },
            "description": "Session cleared"
          },
          "401": {
            "description": "API key required"
          },
          "404": {
            "description": "Session not found"
          }
        },
        "security": [
          {
            "bearerAuth": []
          },
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "Clear session messages"
      }
    },
    "/sessions/{session_id}/messages": {
      "parameters": [
        {
          "in": "path",
          "name": "session_id",
          "required": true,
          "schema": {
            "format": "uuid",
            "type": "string"
          }
        }
      ],
      "post": {
        "description": "Appends a message to an existing session.",
        "operationId": "addSessionMessage",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SessionMessageCreateRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SessionMessageResponse"
                }
              }
            },
            "description": "Message appended"
          },
          "400": {
            "description": "Invalid request"
          },
          "401": {
            "description": "API key required"
          },
          "404": {
            "description": "Session not found"
          }
        },
        "security": [
          {
            "bearerAuth": []
          },
          {
            "apiKeyAuth": []
          }
        ],
        "summary": "Append a session message"
      }
    }
  },
  "servers": [
    {
      "url": "https://api.modelrelay.ai/api/v1"
    }
  ]
}